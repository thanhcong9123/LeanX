@using LearnX_Data.Entities
@model IEnumerable<EBook>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư viện Sách điện tử - LearX</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/css/ebook/index.css" rel="stylesheet">
</head>
<body>
    <style>
     
    </style>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">
                <div class="title-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                Thư viện Sách điện tử
            </h1>
            <p class="page-subtitle">Khám phá kho tàng tri thức với hàng ngàn cuốn sách điện tử chất lượng cao</p>
            
            @if (Model != null && Model.Any())
            {
                <div class="stats-bar">
                    <div class="stat-item">
                        <i class="fas fa-books"></i>
                        <span class="stat-number">@Model.Count()</span>
                        <span>cuốn sách</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-eye"></i>
                        <span class="stat-number">@Model.Sum(b => b.View)</span>
                        <span>lượt xem</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-crown"></i>
                        <span class="stat-number">@Model.Count(b => b.Status == "Free")</span>
                        <span>sách miễn phí</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-tags"></i>
                        <span class="stat-number">@Model.Where(b => !string.IsNullOrEmpty(b.NameCategory)).Select(b => b.NameCategory).Distinct().Count()</span>
                        <span>danh mục</span>
                    </div>
                </div>
            }
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <div class="controls-row">
                <div class="search-filters">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Tìm kiếm sách theo tên, tác giả..." id="searchInput">
                    </div>
                    
                    <div class="filter-group">
                        <select class="filter-select" id="categoryFilter">
                            <option value="">Tất cả danh mục</option>
                            @if (Model != null)
                            {
                                @foreach (var category in Model.Where(b => !string.IsNullOrEmpty(b.NameCategory)).Select(b => b.NameCategory).Distinct())
                                {
                                    <option value="@category">@category</option>
                                }
                            }
                        </select>
                        
                        <select class="filter-select" id="statusFilter">
                            <option value="">Tất cả trạng thái</option>
                            <option value="Free">Miễn phí</option>
                            <option value="Premium">Premium</option>
                        </select>
                    </div>
                </div>
                
                <div class="view-controls">
                    <button class="view-btn active" id="gridView" title="Xem dạng lưới">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" id="listView" title="Xem dạng danh sách">
                        <i class="fas fa-list"></i>
                    </button>
                    <a href="#" class="add-btn">
                        <i class="fas fa-plus"></i>
                        Thêm sách mới
                    </a>
                </div>
            </div>
        </div>

        <!-- Books Grid View -->
        @if (Model != null && Model.Any())
        {
            <div class="books-grid" id="booksGrid">
                @foreach (var book in Model)
                {
                    <div class="book-card" data-category="@book.NameCategory" data-status="@book.Status">
                        <div class="book-image">
                            @if (!string.IsNullOrEmpty(book.imgPath))
                            {
                                <img src="@book.imgPath" alt="@book.Title" class="book-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjI4MCIgdmlld0JveD0iMCAwIDMyMCAyODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMjgwIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMF8xKSIvPgo8cGF0aCBkPSJNMTYwIDEyMEMxNzEuMDQ2IDEyMCAxODAgMTI4Ljk1NCAxODAgMTQwQzE4MCAxNTEuMDQ2IDE3MS4wNDYgMTYwIDE2MCAxNjBDMTQ4Ljk1NCAxNjAgMTQwIDE1MS4wNDYgMTQwIDE0MEMxNDAgMTI4Ljk1NCAxNDguOTU0IDEyMCAxNjAgMTIwWiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfMF8xIiB4MT0iMCIgeTE9IjAiIHgyPSIzMjAiIHkyPSIyODAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K'; this.alt='Không có ảnh';">
                            }
                            else
                            {
                                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667EEA 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">
                                    <i class="fas fa-book"></i>
                                </div>
                            }
                            
                            <div class="book-status @(book.Status == "Free" ? "status-free" : "status-premium")">
                                @(book.Status == "Free" ? "Miễn phí" : "Premium")
                            </div>
                            
                            <div class="book-overlay">
                                <div class="quick-actions">
                                    <button class="quick-btn btn-read">
                                        <i class="fas fa-book-reader"></i>
                                        Đọc
                                    </button>
                                    @if (!string.IsNullOrEmpty(book.FilePath))
                                    {
                                        <button class="quick-btn btn-download">
                                            <i class="fas fa-download"></i>
                                            Tải
                                        </button>
                                    }
                                    @if (!string.IsNullOrEmpty(book.LinkYoutube))
                                    {
                                        <button class="quick-btn btn-youtube" onclick="window.open('@book.LinkYoutube', '_blank')">
                                            <i class="fab fa-youtube"></i>
                                            Video
                                        </button>
                                    }
                                </div>
                            </div>
                        </div>
                        
                        <div class="book-content">
                            <div class="book-header">
                                <h3 class="book-title">@book.Title</h3>
                                <div class="book-author">
                                    <i class="fas fa-user-edit"></i>
                                    @(book.Author ?? "Chưa có tác giả")
                                </div>
                            </div>
                            
                            <div class="book-meta">
                                <div class="meta-item">
                                    <div class="meta-icon">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                    <span>@book.CountPages trang</span>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-icon">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <span>@book.View lượt xem</span>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-icon">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                    <span>@book.UploadedAt.ToString("dd/MM/yyyy")</span>
                                </div>
                            </div>
                            
                            @if (!string.IsNullOrEmpty(book.Description))
                            {
                                <div class="book-description">
                                    @book.Description
                                </div>
                            }
                            
                            <div class="book-footer">
                                <div class="book-rating">
                                    <div class="stars">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <i class="fas fa-star star"></i>
                                        }
                                    </div>
                                    <span class="rating-text">(@(book.EvaluateBooks?.Count ?? 0) đánh giá)</span>
                                </div>
                                
                                <div class="book-actions">
                                    <button class="action-btn btn-view" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn btn-edit" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-delete" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Books List View -->
            <div class="books-list" id="booksList">
                @foreach (var book in Model)
                {
                    <div class="book-list-item" data-category="@book.NameCategory" data-status="@book.Status">
                        <div class="list-book-image">
                            @if (!string.IsNullOrEmpty(book.imgPath))
                            {
                                <img src="@book.imgPath" alt="@book.Title" class="list-book-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgODAgMTAwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iODAiIGhlaWdodD0iMTAwIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMF8xKSIvPgo8cGF0aCBkPSJNNDAgMzVDNDUuNTIyOCAzNSA1MCAzOS40NzcyIDUwIDQ1QzUwIDUwLjUyMjggNDUuNTIyOCA1NSA0MCA1NUMzNC40NzcyIDU1IDMwIDUwLjUyMjggMzAgNDVDMzAgMzkuNDc3MiAzNC40NzcyIDM1IDQwIDM1WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfMF8xIiB4MT0iMCIgeTE9IjAiIHgyPSI4MCIgeTI9IjEwMCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjNjY3RUVBIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzc2NGJhMiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgo='; this.alt='Không có ảnh';">
                            }
                            else
                            {
                                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667EEA 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">
                                    <i class="fas fa-book"></i>
                                </div>
                            }
                        </div>
                        
                        <div class="list-book-content">
                            <div class="list-book-info">
                                <h3 class="list-book-title">@book.Title</h3>
                                <div class="list-book-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-user-edit"></i>
                                        <span>@(book.Author ?? "Chưa có tác giả")</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-file-alt"></i>
                                        <span>@book.CountPages trang</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-eye"></i>
                                        <span>@book.View lượt xem</span>
                                    </div>
                                    <div class="meta-item">
                                        <span class="book-status @(book.Status == "Free" ? "status-free" : "status-premium")">
                                            @(book.Status == "Free" ? "Miễn phí" : "Premium")
                                        </span>
                                    </div>
                                </div>
                                @if (!string.IsNullOrEmpty(book.Description))
                                {
                                    <div class="list-book-description">
                                        @book.Description
                                    </div>
                                }
                            </div>
                            
                            <div class="book-actions">
                                <button class="action-btn btn-view" title="Xem chi tiết">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-edit" title="Chỉnh sửa">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-delete" title="Xóa">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h3 class="empty-title">Chưa có sách điện tử nào</h3>
                <p class="empty-description">Thư viện hiện tại chưa có cuốn sách nào. Hãy thêm sách đầu tiên để xây dựng kho tàng tri thức!</p>
                <a href="#" class="add-btn">
                    <i class="fas fa-plus"></i>
                    Thêm sách đầu tiên
                </a>
            </div>
        }
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilter');
            const gridView = document.getElementById('gridView');
            const listView = document.getElementById('listView');
            const booksGrid = document.getElementById('booksGrid');
            const booksList = document.getElementById('booksList');
            const bookCards = document.querySelectorAll('.book-card, .book-list-item');

            // View toggle functionality
            gridView.addEventListener('click', function() {
                gridView.classList.add('active');
                listView.classList.remove('active');
                booksGrid.style.display = 'grid';
                booksList.style.display = 'none';
            });

            listView.addEventListener('click', function() {
                listView.classList.add('active');
                gridView.classList.remove('active');
                booksGrid.style.display = 'none';
                booksList.style.display = 'flex';
            });

            // Search and filter functionality
            function filterBooks() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategory = categoryFilter.value;
                const selectedStatus = statusFilter.value;

                bookCards.forEach(card => {
                    const title = card.querySelector('.book-title, .list-book-title').textContent.toLowerCase();
                    const author = card.querySelector('.book-author, .list-book-meta .meta-item span')?.textContent.toLowerCase() || '';
                    const description = card.querySelector('.book-description, .list-book-description')?.textContent.toLowerCase() || '';
                    const category = card.dataset.category || '';
                    const status = card.dataset.status || '';

                    const matchesSearch = title.includes(searchTerm) || author.includes(searchTerm) || description.includes(searchTerm);
                    const matchesCategory = !selectedCategory || category === selectedCategory;
                    const matchesStatus = !selectedStatus || status === selectedStatus;

                    if (matchesSearch && matchesCategory && matchesStatus) {
                        card.style.display = 'block';
                        card.style.animation = 'fadeIn 0.3s ease-in';
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Check if no results
                const visibleCards = Array.from(bookCards).filter(card => card.style.display !== 'none');
                const activeContainer = booksGrid.style.display !== 'none' ? booksGrid : booksList;
                
                if (visibleCards.length === 0 && activeContainer) {
                    if (!document.querySelector('.no-results')) {
                        const noResults = document.createElement('div');
                        noResults.className = 'no-results empty-state';
                        noResults.innerHTML = `
                            <div class="empty-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <h3 class="empty-title">Không tìm thấy kết quả</h3>
                            <p class="empty-description">Không có sách nào phù hợp với tiêu chí tìm kiếm của bạn. Hãy thử với từ khóa khác.</p>
                        `;
                        activeContainer.appendChild(noResults);
                    }
                } else {
                    const noResults = document.querySelector('.no-results');
                    if (noResults) {
                        noResults.remove();
                    }
                }
            }

            // Event listeners for search and filters
            searchInput.addEventListener('input', filterBooks);
            categoryFilter.addEventListener('change', filterBooks);
            statusFilter.addEventListener('change', filterBooks);

            // Action buttons
            document.querySelectorAll('.btn-view').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.book-card, .book-list-item');
                    const title = card.querySelector('.book-title, .list-book-title').textContent;
                    // Redirect to view page
                    console.log('Viewing book:', title);
                });
            });

            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.book-card, .book-list-item');
                    const title = card.querySelector('.book-title, .list-book-title').textContent;
                    // Redirect to edit page
                    console.log('Editing book:', title);
                });
            });

            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.book-card, .book-list-item');
                    const title = card.querySelector('.book-title, .list-book-title').textContent;
                    
                    if (confirm(`Bạn có chắc chắn muốn xóa sách "${title}"?`)) {
                        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        this.disabled = true;
                        
                        setTimeout(() => {
                            card.style.animation = 'fadeOut 0.3s ease-out';
                            setTimeout(() => {
                                card.remove();
                            }, 300);
                        }, 1000);
                    }
                });
            });

            // Quick action buttons
            document.querySelectorAll('.btn-read').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.book-card');
                    const title = card.querySelector('.book-title').textContent;
                    console.log('Reading book:', title);
                });
            });

            document.querySelectorAll('.btn-download').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.book-card');
                    const title = card.querySelector('.book-title').textContent;
                    console.log('Downloading book:', title);
                });
            });
        });

        // CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @@keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            @@keyframes fadeOut {
                from { opacity: 1; transform: scale(1); }
                to { opacity: 0; transform: scale(0.8); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
